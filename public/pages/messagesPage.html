<div class="page-container" id="messagesPage">
  <section class="page-hero">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 text-center page-hero-content" data-aos="fade-up">
          <h1>Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h1>
          <p class="lead">ØªÙˆØ§ØµÙ„ Ø³Ø±ÙŠØ¹ ÙˆØ¢Ù…Ù† Ø¨ÙŠÙ† Ù…ÙˆØ¸ÙÙŠ Ø§Ù„Ø´Ø±ÙƒØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
        </div>
      </div>
    </div>
  </section>

  <section class="page-content">
    <div class="container">
      <div class="messages-shell">
        <!-- Sidebar (threads) -->
        <aside class="messages-sidebar">
          <div class="sidebar-header">
            <div class="sidebar-title">
              <i class="bi bi-chat-left-text-fill"></i>
              <span>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</span>
            </div>
            <div class="sidebar-actions">
              <button class="btn btn-sm btn-outline-primary" type="button" onclick="startNewThread()" title="Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©">
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="btn btn-sm btn-outline-secondary" type="button" onclick="refreshThreads()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
            </div>
          </div>

          <div class="sidebar-search">
            <div class="search-icon">
              <i class="bi bi-search"></i>
            </div>
            <input class="form-control search-input" id="msgSearch" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª..." oninput="renderMessageThreads()" />
            <button class="btn btn-clear-search" id="clearSearchBtn" onclick="clearSearch()" title="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«">
              <i class="bi bi-x"></i>
            </button>
          </div>

          <div class="thread-list-header">
            <div class="thread-list-title">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
            <div class="thread-list-count" id="threadCount">0 Ù…Ø­Ø§Ø¯Ø«Ø©</div>
          </div>

          <div class="thread-list" id="messagesThreadList">
            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
          </div>

          <div class="sidebar-footer">
            <div class="user-profile">
              <div class="avatar" id="sidebarUserAvatar"></div>
              <div class="user-info">
                <div class="user-name" id="sidebarUserName">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
                <div class="user-status">
                  <span class="status-indicator" id="sidebarUserStatus"></span>
                  <span id="sidebarStatusText">Ø¬Ø§Ù‡Ø²</span>
                </div>
              </div>
            </div>
            <button class="btn btn-sm btn-settings" type="button" onclick="openChatSettings()" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©">
              <i class="bi bi-gear-fill"></i>
            </button>
          </div>
        </aside>

        <!-- Chat area -->
        <section class="messages-chat">
          <div class="chat-header" id="chatHeader">
            <div class="chat-peer">
              <div class="avatar" id="chatPeerAvatar">
                <i class="bi bi-person-circle"></i>
              </div>
              <div class="meta">
                <div class="name" id="chatPeerName">Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø©</div>
                <div class="status" id="chatPeerStatus">
                  <span class="status-dot"></span>
                  <span id="chatPeerStatusText">Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ø¨Ø¯Ø¡</span>
                </div>
              </div>
            </div>
            <div class="chat-actions">
              <button class="btn btn-action" type="button" onclick="toggleChatInfo()" title="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                <i class="bi bi-info-circle"></i>
              </button>
              <button class="btn btn-action" type="button" onclick="searchInChat()" title="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                <i class="bi bi-search"></i>
              </button>
              <button class="btn btn-action" type="button" onclick="clearThread()" title="Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                <i class="bi bi-trash3"></i>
              </button>
            </div>
          </div>

          <!-- Chat info panel (hidden by default) -->
          <div class="chat-info-panel" id="chatInfoPanel">
            <div class="chat-info-header">
              <h6>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h6>
              <button class="btn btn-sm" onclick="toggleChatInfo()">
                <i class="bi bi-x"></i>
              </button>
            </div>
            <div class="chat-info-content">
              <div class="chat-info-avatar">
                <div class="avatar-lg" id="chatInfoAvatar"></div>
              </div>
              <div class="chat-info-name" id="chatInfoName">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
              <div class="chat-info-status" id="chatInfoStatus">Ø¬Ø§Ù‡Ø²</div>
              <hr />
              <div class="chat-info-section">
                <h6>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h6>
                <div class="info-item">
                  <span class="info-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:</span>
                  <span class="info-value" id="chatMessageCount">0</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Ø£Ù†Ø´Ø¦Øª ÙÙŠ:</span>
                  <span class="info-value" id="chatCreatedAt">--/--/----</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·:</span>
                  <span class="info-value" id="chatLastActivity">--:--</span>
                </div>
              </div>
            </div>
          </div>

          <div class="chat-messages-container">
            <div class="chat-messages" id="messagesThreadView">
              <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
            </div>
          </div>

          <!-- Compose area -->
          <div class="chat-compose">
            <div class="compose-left">
              <button class="btn btn-attach" type="button" onclick="attachFile()" title="Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù">
                <i class="bi bi-paperclip"></i>
              </button>
              <button class="btn btn-emoji" type="button" onclick="toggleEmojiPicker()" title="Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠÙ…ÙˆØ¬ÙŠ">
                <i class="bi bi-emoji-smile"></i>
              </button>
            </div>
            <div class="compose-center">
              <div class="compose-input-wrapper">
                <input class="form-control" id="msgBody" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." 
                  onkeydown="if(event.key==='Enter' && !event.shiftKey){ event.preventDefault(); sendInternalMessage(); }" />
                <!-- Emoji picker (hidden by default) -->
                <div class="emoji-picker" id="emojiPicker">
                  <div class="emoji-picker-header">
                    <span>Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ</span>
                    <button class="btn btn-sm" onclick="toggleEmojiPicker()">
                      <i class="bi bi-x"></i>
                    </button>
                  </div>
                  <div class="emoji-picker-content">
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ‘')">ğŸ‘</button>
                    <button class="emoji-btn" onclick="insertEmoji('â¤ï¸')">â¤ï¸</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ˜')">ğŸ˜</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ¤”')">ğŸ¤”</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ™')">ğŸ™</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ”¥')">ğŸ”¥</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ‰')">ğŸ‰</button>
                    <button class="emoji-btn" onclick="insertEmoji('ğŸ’¯')">ğŸ’¯</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="compose-right">
              <button class="btn btn-primary btn-send" type="button" onclick="sendInternalMessage()" id="sendMessageBtn" aria-label="Ø¥Ø±Ø³Ø§Ù„">
                <i class="bi bi-send-fill"></i>
              </button>
            </div>
          </div>

          <div class="chat-hint text-muted">
            <i class="bi bi-info-circle"></i>
            Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ø³Ù„Ø© Ø¯Ø§Ø®Ù„ÙŠ Ø¢Ù…Ù†. ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø·Ù‡ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹.
          </div>
        </section>
      </div>
    </div>
  </section>
</div>

<!-- Modal for starting new thread -->
<div class="modal fade" id="newThreadModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙØ§Ù‹:</label>
          <select class="form-select" id="newThreadEmployeeSelect">
            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰:</label>
          <textarea class="form-control" id="newThreadMessage" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="button" class="btn btn-primary" onclick="createNewThread()">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
      </div>
    </div>
  </div>
</div>

<!-- WhatsApp-like Chat Settings Modal -->
<div class="modal fade" id="waChatSettingsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#waTabAccount" type="button" role="tab">Ø§Ù„Ø­Ø³Ø§Ø¨</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#waTabPrivacy" type="button" role="tab">Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#waTabChats" type="button" role="tab">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#waTabNotifs" type="button" role="tab">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
          </li>
        </ul>

        <div class="tab-content pt-3">
          <div class="tab-pane fade show active" id="waTabAccount" role="tabpanel">
            <div class="row g-3 align-items-center">
              <div class="col-md-4 text-center">
                <div class="wa-profile-avatar" id="waProfileAvatar">
                  <i class="bi bi-person-circle"></i>
                </div>
                <input type="file" class="form-control mt-2" id="waProfileAvatarFile" accept="image/*" />
                <button class="btn btn-outline-secondary btn-sm mt-2" type="button" onclick="document.getElementById('waProfileAvatarFile').click()">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</button>
              </div>
              <div class="col-md-8">
                <label class="form-label">Ø§Ù„Ø§Ø³Ù…</label>
                <input class="form-control" id="waProfileName" />
                <label class="form-label mt-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                <input class="form-control" id="waProfileStatus" placeholder="Ù…Ø«Ù„: Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ù…Ù„" />
                <div class="mt-3">
                  <button class="btn btn-primary" type="button" onclick="saveChatProfile()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-pane fade" id="waTabPrivacy" role="tabpanel">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±</label>
                <select class="form-select" id="waPrivacyLastSeen">
                  <option value="everyone">Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
                  <option value="contacts">Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</option>
                  <option value="nobody">Ù„Ø§ Ø£Ø­Ø¯</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="waPrivacyReadReceipts" checked />
                  <label class="form-check-label" for="waPrivacyReadReceipts">ØªÙØ¹ÙŠÙ„</label>
                </div>
              </div>
              <div class="col-md-12">
                <label class="form-label">ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</label>
                <select class="form-select" id="waProfileVisibility">
                  <option value="everyone">Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
                  <option value="contacts">Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</option>
                  <option value="nobody">Ù„Ø§ Ø£Ø­Ø¯</option>
                </select>
              </div>
            </div>
          </div>

          <div class="tab-pane fade" id="waTabChats" role="tabpanel">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</label>
                <select class="form-select" id="waChatWallpaper">
                  <option value="wa1">ÙˆØ§ØªØ³Ø§Ø¨ (ØºØ§Ù…Ù‚)</option>
                  <option value="wa2">Ù†Ù‚Ø´Ø© ÙØ§ØªØ­Ø©</option>
                  <option value="solid">Ù„ÙˆÙ† Ø³Ø§Ø¯Ø©</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</label>
                <select class="form-select" id="waChatFontSize">
                  <option value="sm">ØµØºÙŠØ±</option>
                  <option value="md" selected>Ù…ØªÙˆØ³Ø·</option>
                  <option value="lg">ÙƒØ¨ÙŠØ±</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø­ÙØ¸ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="waAutoSaveMedia" />
                  <label class="form-check-label" for="waAutoSaveMedia">ØªÙØ¹ÙŠÙ„</label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="waShowPreviews" checked />
                  <label class="form-check-label" for="waShowPreviews">ØªÙØ¹ÙŠÙ„</label>
                </div>
              </div>
              <div class="col-12">
                <button class="btn btn-primary" type="button" onclick="saveChatSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
              </div>
            </div>
          </div>

          <div class="tab-pane fade" id="waTabNotifs" role="tabpanel">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="waNotifEnabled" checked />
                  <label class="form-check-label" for="waNotifEnabled">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø§Ù„ØµÙˆØª</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="waNotifSound" checked />
                  <label class="form-check-label" for="waNotifSound">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="waNotifVibrate" checked />
                  <label class="form-check-label" for="waNotifVibrate">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²</label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ù†ØºÙ…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</label>
                <select class="form-select" id="waNotifTone">
                  <option value="default">Ø§Ù„Ù†ØºÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</option>
                  <option value="chime">Ù†ØºÙ…Ø© Ø±Ù†ÙŠÙ†</option>
                  <option value="beep">Ù†ØºÙ…Ø© Ø¨ÙŠØ¨</option>
                </select>
              </div>
              <div class="col-12">
                <button class="btn btn-primary" type="button" onclick="saveChatSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for chat search -->
<div class="modal fade" id="chatSearchModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Ø§Ø¨Ø­Ø« ÙÙŠ Ø±Ø³Ø§Ø¦Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:</label>
          <input class="form-control" id="chatSearchInput" placeholder="Ø§ÙƒØ«Ø± ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«..." />
        </div>
        <div class="search-results" id="chatSearchResults">
          <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
        <button type="button" class="btn btn-primary" onclick="performChatSearch()">Ø¨Ø­Ø«</button>
      </div>
    </div>
  </div>
</div>

<style>
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ù„ØªØ¨Ø¯Ùˆ Ù…Ø«Ù„ ÙˆØ§ØªØ³Ø§Ø¨ */
  .messages-shell {
    display: flex;
    height: 75vh;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    background-color: #fff;
  }
  
  .messages-sidebar {
    width: 350px;
    border-right: 1px solid #e1e1e1;
    display: flex;
    flex-direction: column;
    background-color: #f8f9fa;
  }
  
  .sidebar-header {
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f0f2f5;
    border-bottom: 1px solid #e1e1e1;
  }
  
  .sidebar-title {
    display: flex;
    align-items: center;
    font-weight: 600;
    font-size: 1.2rem;
    color: #333;
  }
  
  .sidebar-title i {
    margin-left: 8px;
    color: #25D366;
  }
  
  .sidebar-actions {
    display: flex;
    gap: 8px;
  }
  
  .sidebar-search {
    padding: 10px 15px;
    position: relative;
    background-color: #f0f2f5;
    border-bottom: 1px solid #e1e1e1;
  }
  
  .search-icon {
    position: absolute;
    right: 25px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
  }
  
  .search-input {
    padding-right: 35px;
    background-color: #fff;
    border: 1px solid #e1e1e1;
    border-radius: 20px;
  }
  
  .btn-clear-search {
    position: absolute;
    left: 25px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #666;
    display: none;
  }
  
  .thread-list-header {
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e1e1e1;
    background-color: #f8f9fa;
  }
  
  .thread-list-title {
    font-weight: 600;
    color: #333;
  }
  
  .thread-list-count {
    font-size: 0.85rem;
    color: #666;
  }
  
  .thread-list {
    flex: 1;
    overflow-y: auto;
    background-color: #fff;
  }
  
  .thread-item {
    padding: 12px 15px;
    display: flex;
    align-items: center;
    border-bottom: 1px solid #f5f5f5;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .thread-item:hover {
    background-color: #f5f5f5;
  }
  
  .thread-item.active {
    background-color: #e8f5e9;
    border-right: 3px solid #25D366;
  }
  
  .thread-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e1e1e1;
    color: #666;
    font-size: 1.5rem;
    margin-left: 12px;
  }
  
  .thread-content {
    flex: 1;
  }
  
  .thread-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
  }
  
  .thread-name {
    font-weight: 600;
    color: #333;
  }
  
  .thread-time {
    font-size: 0.8rem;
    color: #666;
  }
  
  .thread-preview {
    font-size: 0.9rem;
    color: #666;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .thread-unread {
    background-color: #25D366;
    color: white;
    font-size: 0.7rem;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: auto;
  }
  
  .sidebar-footer {
    padding: 12px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f0f2f5;
    border-top: 1px solid #e1e1e1;
  }
  
  .user-profile {
    display: flex;
    align-items: center;
  }
  
  .user-info {
    margin-right: 10px;
  }
  
  .user-name {
    font-weight: 600;
    font-size: 0.95rem;
  }
  
  .user-status {
    display: flex;
    align-items: center;
    font-size: 0.8rem;
    color: #666;
  }
  
  .status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #25D366;
    margin-left: 5px;
  }
  
  .btn-settings {
    background: none;
    border: none;
    color: #666;
    font-size: 1.2rem;
  }
  
  .messages-chat {
    flex: 1;
    display: flex;
    flex-direction: column;
    background-color: #f0f2f5;
    position: relative;
  }
  
  .chat-header {
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f0f2f5;
    border-bottom: 1px solid #e1e1e1;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }
  
  .chat-peer {
    display: flex;
    align-items: center;
  }
  
  .chat-peer .avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e1e1e1;
    color: #666;
    font-size: 1.5rem;
    margin-left: 12px;
  }
  
  .meta .name {
    font-weight: 600;
    font-size: 1.1rem;
    color: #333;
  }
  
  .meta .status {
    display: flex;
    align-items: center;
    font-size: 0.85rem;
    color: #666;
  }
  
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #25D366;
    margin-left: 5px;
  }
  
  .chat-actions {
    display: flex;
    gap: 10px;
  }
  
  .btn-action {
    background: none;
    border: none;
    color: #666;
    font-size: 1.2rem;
  }
  
  .chat-messages-container {
    flex: 1;
    overflow: hidden;
    position: relative;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNlZGVlZWUiIGZpbGwtb3BhY2l0eT0iMC40Ij48cGF0aCBkPSJNNDAgMEgyMEM4Ljk1NCAwIDAgOC45NTQgMCAyMGMwIDExLjA0NiA4Ljk1NCAyMCAyMCAyMGgxMGMxMS4wNDYgMCAyMC04Ljk1NCAyMC0yMHMtOC45NTQtMjAtMjAtMjB6TTIwIDJjOS45NDEgMCAxOCA4LjA1OSAxOCAxOHMtOC4wNTkgMTgtMTggMThINmMtOS45NDEgMC0xOC04LjA1OS0xOC0xOHM4LjA1OS0xOCAxOC0xOGgxNHoiLz48L2c+PC9nPjwvc3ZnPg==');
    background-size: 60px 60px;
    background-color: #efeae2;
  }
  
  .chat-messages {
    padding: 20px;
    overflow-y: auto;
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .message {
    max-width: 65%;
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
  }
  
  .message.sent {
    align-self: flex-end;
  }
  
  .message.received {
    align-self: flex-start;
  }
  
  .message-bubble {
    padding: 8px 12px;
    border-radius: 18px;
    position: relative;
    word-wrap: break-word;
  }
  
  .message.sent .message-bubble {
    background-color: #d9fdd3;
    border-top-right-radius: 5px;
  }
  
  .message.received .message-bubble {
    background-color: #fff;
    border-top-left-radius: 5px;
  }
  
  .message-time {
    font-size: 0.7rem;
    color: #666;
    margin-top: 3px;
    align-self: flex-end;
  }
  
  .message.sent .message-time {
    text-align: left;
  }
  
  .message.received .message-time {
    text-align: right;
  }
  
  .message-date {
    text-align: center;
    margin: 15px 0;
    color: #666;
    font-size: 0.8rem;
    position: relative;
  }
  
  .message-date::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background-color: #e1e1e1;
    z-index: 1;
  }
  
  .message-date span {
    background-color: #f0f2f5;
    padding: 0 10px;
    position: relative;
    z-index: 2;
  }
  
  .chat-compose {
    padding: 12px 20px;
    display: flex;
    align-items: center;
    background-color: #f0f2f5;
    border-top: 1px solid #e1e1e1;
  }
  
  .compose-left, .compose-right {
    flex: 0 0 auto;
  }
  
  .compose-center {
    flex: 1;
    margin: 0 12px;
    position: relative;
  }
  
  .btn-attach, .btn-emoji, .btn-send {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
  }
  
  .btn-attach, .btn-emoji {
    background-color: transparent;
    color: #666;
    font-size: 1.2rem;
  }
  
  .btn-send {
    background-color: #25D366;
    color: white;
  }
  
  .compose-input-wrapper {
    position: relative;
  }
  
  .emoji-picker {
    position: absolute;
    bottom: 50px;
    left: 0;
    width: 250px;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid #e1e1e1;
    z-index: 1000;
    display: none;
  }
  
  .emoji-picker-header {
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e1e1e1;
  }
  
  .emoji-picker-content {
    padding: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
  }
  
  .emoji-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .emoji-btn:hover {
    background-color: #f5f5f5;
  }
  
  .chat-info-panel {
    position: absolute;
    top: 0;
    right: 0;
    width: 300px;
    height: 100%;
    background-color: white;
    border-left: 1px solid #e1e1e1;
    box-shadow: -5px 0 15px rgba(0, 0, 0, 0.05);
    z-index: 100;
    display: none;
    flex-direction: column;
  }
  
  .chat-info-header {
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e1e1e1;
  }
  
  .chat-info-content {
    padding: 20px;
    flex: 1;
    overflow-y: auto;
  }
  
  .chat-info-avatar {
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
  }
  
  .avatar-lg {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e1e1e1;
    color: #666;
    font-size: 3rem;
  }
  
  .chat-info-name {
    text-align: center;
    font-weight: 600;
    font-size: 1.3rem;
    margin-bottom: 5px;
  }
  
  .chat-info-status {
    text-align: center;
    color: #666;
    margin-bottom: 20px;
  }
  
  .chat-info-section {
    margin-top: 20px;
  }
  
  .info-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #f5f5f5;
  }
  
  .info-label {
    color: #666;
  }
  
  .info-value {
    font-weight: 500;
  }
  
  .chat-hint {
    padding: 8px 20px;
    background-color: #fff8e1;
    font-size: 0.8rem;
    text-align: center;
    border-top: 1px solid #ffe082;
  }
  
  .chat-hint i {
    margin-left: 5px;
  }
  
  .wa-profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background-color: #e1e1e1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: #666;
    margin: 0 auto;
  }
  
  @media (max-width: 992px) {
    .messages-shell {
      flex-direction: column;
      height: 85vh;
    }
    
    .messages-sidebar {
      width: 100%;
      height: 40%;
    }
    
    .messages-chat {
      height: 60%;
    }
    
    .chat-info-panel {
      width: 100%;
    }
  }
</style>

<script>
  // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
  let currentUser = {
    id: 1,
    name: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
    email: "ahmed@company.com",
    avatar: "",
    status: "Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ù…Ù„",
    lastSeen: "everyone",
    readReceipts: true
  };
  
  let employees = [
    { id: 2, name: "Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ", email: "sara@company.com", status: "Ù…ØªØµÙ„", lastSeen: "10:15", avatar: "" },
    { id: 3, name: "Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯", email: "mohamed@company.com", status: "ÙÙŠ Ø§Ø¬ØªÙ…Ø§Ø¹", lastSeen: "09:45", avatar: "" },
    { id: 4, name: "ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†", email: "fatima@company.com", status: "Ø¨Ø¹ÙŠØ¯", lastSeen: "Ø£Ù…Ø³", avatar: "" },
    { id: 5, name: "Ø®Ø§Ù„Ø¯ Ø¹Ù…Ø±", email: "khaled@company.com", status: "Ù…ØªØ§Ø­", lastSeen: "08:30", avatar: "" },
    { id: 6, name: "Ù†ÙˆØ±Ø© Ø³Ø¹ÙŠØ¯", email: "nora@company.com", status: "Ù…ØªØµÙ„", lastSeen: "Ø§Ù„Ø¢Ù†", avatar: "" },
    { id: 7, name: "ÙŠÙˆØ³Ù Ø£Ø­Ù…Ø¯", email: "youssef@company.com", status: "Ù…Ø´ØºÙˆÙ„", lastSeen: "11:20", avatar: "" }
  ];
  
  let messageThreads = [];
  let activeThreadId = null;
  let chatSettings = {
    wallpaper: "wa1",
    fontSize: "md",
    autoSaveMedia: false,
    showPreviews: true,
    notifications: true,
    sound: true,
    vibrate: true,
    tone: "default"
  };
  
  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
  document.addEventListener('DOMContentLoaded', function() {
    loadUserData();
    loadChatSettings();
    loadMessageThreads();
    renderMessageThreads();
    updateUserProfileUI();
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    setInterval(updateUserStatus, 30000);
    
    // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±
    setInterval(updateLastSeen, 60000);
  });
  
  // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage
  function loadUserData() {
    const savedUser = localStorage.getItem('chatUser');
    if (savedUser) {
      currentUser = { ...currentUser, ...JSON.parse(savedUser) };
    }
  }
  
  // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ localStorage
  function saveUserData() {
    localStorage.setItem('chatUser', JSON.stringify(currentUser));
  }
  
  // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
  function loadChatSettings() {
    const savedSettings = localStorage.getItem('chatSettings');
    if (savedSettings) {
      chatSettings = JSON.parse(savedSettings);
    }
  }
  
  // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
  function saveChatSettings() {
    localStorage.setItem('chatSettings', JSON.stringify(chatSettings));
    applyChatSettings();
    showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­", "success");
  }
  
  // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
  function applyChatSettings() {
    // ØªØ·Ø¨ÙŠÙ‚ Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    const chatContainer = document.querySelector('.chat-messages-container');
    if (chatContainer) {
      if (chatSettings.wallpaper === 'wa1') {
        chatContainer.style.backgroundImage = 'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNlZGVlZWUiIGZpbGwtb3BhY2l0eT0iMC40Ij48cGF0aCBkPSJNNDAgMEgyMEM4Ljk1NCAwIDAgOC45NTQgMCAyMGMwIDExLjA0NiA4Ljk1NCAyMCAyMCAyMGgxMGMxMS4wNDYgMCAyMC04Ljk1NCAyMC0yMHMtOC45NTQtMjAtMjAtMjB6TTIwIDJjOS45NDEgMCAxOCA4LjA1OSAxOCAxOHMtOC4wNTkgMTgtMTggMThINmMtOS45NDEgMC0xOC04LjA1OS0xOC0xOHM4LjA1OS0xOCAxOC0xOGgxNHoiLz48L2c+PC9nPjwvc3ZnPg==")';
        chatContainer.style.backgroundColor = '#efeae2';
      } else if (chatSettings.wallpaper === 'wa2') {
        chatContainer.style.backgroundImage = 'none';
        chatContainer.style.backgroundColor = '#f5f5f5';
      } else if (chatSettings.wallpaper === 'solid') {
        chatContainer.style.backgroundImage = 'none';
        chatContainer.style.backgroundColor = '#ffffff';
      }
    }
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
    const chatMessages = document.querySelector('.chat-messages');
    if (chatMessages) {
      if (chatSettings.fontSize === 'sm') {
        chatMessages.style.fontSize = '0.85rem';
      } else if (chatSettings.fontSize === 'md') {
        chatMessages.style.fontSize = '1rem';
      } else if (chatSettings.fontSize === 'lg') {
        chatMessages.style.fontSize = '1.15rem';
      }
    }
  }
  
  // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
  function loadMessageThreads() {
    const savedThreads = localStorage.getItem('messageThreads');
    if (savedThreads) {
      messageThreads = JSON.parse(savedThreads);
    } else {
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
      messageThreads = [
        {
          id: 1,
          employeeId: 2,
          employeeName: "Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ",
          lastMessage: "Ù‡Ù„ Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ",
          lastMessageTime: "10:15",
          unread: 2,
          messages: [
            { id: 1, senderId: 2, text: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø­Ù…Ø¯ØŒ ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ", time: "09:30", date: "2023-10-15" },
            { id: 2, senderId: 1, text: "Ø£Ù‡Ù„Ø§Ù‹ Ø³Ø§Ø±Ø©ØŒ Ø£Ù†Ø§ Ø¨Ø®ÙŠØ± Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡. ÙˆØ£Ù†ØªØŸ", time: "09:32", date: "2023-10-15" },
            { id: 3, senderId: 2, text: "Ø£Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹ Ø¨Ø®ÙŠØ±ØŒ Ø´ÙƒØ±Ø§Ù‹. Ù‡Ù„ Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ", time: "10:15", date: "2023-10-15" }
          ],
          createdAt: "2023-10-15"
        },
        {
          id: 2,
          employeeId: 3,
          employeeName: "Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯",
          lastMessage: "Ù†Ø¹Ù…ØŒ Ø³Ø£Ø±Ø³Ù„Ù‡ Ù„Ùƒ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø©",
          lastMessageTime: "Ø£Ù…Ø³",
          unread: 0,
          messages: [
            { id: 1, senderId: 1, text: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø­Ù…Ø¯ØŒ Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ØŸ", time: "14:20", date: "2023-10-14" },
            { id: 2, senderId: 3, text: "Ù†Ø¹Ù…ØŒ Ø³Ø£Ø±Ø³Ù„Ù‡ Ù„Ùƒ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø©", time: "14:25", date: "2023-10-14" }
          ],
          createdAt: "2023-10-14"
        },
        {
          id: 3,
          employeeId: 4,
          employeeName: "ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†",
          lastMessage: "Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©",
          lastMessageTime: "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
          unread: 0,
          messages: [
            { id: 1, senderId: 4, text: "Ø£Ø­Ù…Ø¯ØŒ Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø§Ø¹Ø¯ØªÙŠ ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŸ", time: "11:10", date: "2023-10-10" },
            { id: 2, senderId: 1, text: "Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙØ§Ø·Ù…Ø©ØŒ Ø£Ø®Ø¨Ø±ÙŠÙ†ÙŠ Ø¨Ù…Ø§ ØªØ­ØªØ§Ø¬ÙŠÙ†", time: "11:15", date: "2023-10-10" },
            { id: 3, senderId: 4, text: "Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©", time: "11:20", date: "2023-10-10" }
          ],
          createdAt: "2023-10-10"
        }
      ];
      saveMessageThreads();
    }
  }
  
  // Ø­ÙØ¸ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
  function saveMessageThreads() {
    localStorage.setItem('messageThreads', JSON.stringify(messageThreads));
  }
  
  // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
  function renderMessageThreads() {
    const threadList = document.getElementById('messagesThreadList');
    const threadCount = document.getElementById('threadCount');
    const searchTerm = document.getElementById('msgSearch').value.toLowerCase();
    
    let filteredThreads = messageThreads;
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    if (searchTerm) {
      filteredThreads = messageThreads.filter(thread => 
        thread.employeeName.toLowerCase().includes(searchTerm) ||
        thread.lastMessage.toLowerCase().includes(searchTerm)
      );
      document.getElementById('clearSearchBtn').style.display = 'block';
    } else {
      document.getElementById('clearSearchBtn').style.display = 'none';
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
    threadCount.textContent = `${filteredThreads.length} Ù…Ø­Ø§Ø¯Ø«Ø©`;
    
    // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª
    if (filteredThreads.length === 0) {
      threadList.innerHTML = `
        <div class="empty-threads">
          <div class="empty-icon">
            <i class="bi bi-chat-left-text"></i>
          </div>
          <div class="empty-text">
            ${searchTerm ? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­Ø§Ø¯Ø«Ø§Øª' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨Ø¹Ø¯'}
          </div>
          ${!searchTerm ? '<button class="btn btn-primary mt-2" onclick="startNewThread()">Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>' : ''}
        </div>
      `;
      return;
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
    let threadsHTML = '';
    
    filteredThreads.forEach(thread => {
      const isActive = thread.id === activeThreadId;
      threadsHTML += `
        <div class="thread-item ${isActive ? 'active' : ''}" onclick="openThread(${thread.id})">
          <div class="thread-avatar">
            <i class="bi bi-person-circle"></i>
          </div>
          <div class="thread-content">
            <div class="thread-header">
              <div class="thread-name">${thread.employeeName}</div>
              <div class="thread-time">${thread.lastMessageTime}</div>
            </div>
            <div class="thread-preview">${thread.lastMessage}</div>
          </div>
          ${thread.unread > 0 ? `<div class="thread-unread">${thread.unread}</div>` : ''}
        </div>
      `;
    });
    
    threadList.innerHTML = threadsHTML;
  }
  
  // ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø©
  function openThread(threadId) {
    activeThreadId = threadId;
    const thread = messageThreads.find(t => t.id === threadId);
    
    if (!thread) return;
    
    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    document.getElementById('chatPeerName').textContent = thread.employeeName;
    document.getElementById('chatPeerStatusText').textContent = "Ù…ØªØµÙ„";
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    document.getElementById('chatInfoName').textContent = thread.employeeName;
    document.getElementById('chatInfoStatus').textContent = "Ù…ØªØµÙ„";
    document.getElementById('chatMessageCount').textContent = thread.messages.length;
    document.getElementById('chatCreatedAt').textContent = thread.createdAt;
    document.getElementById('chatLastActivity').textContent = thread.lastMessageTime;
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
    renderMessageThreads();
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    renderThreadMessages(thread);
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
    thread.unread = 0;
    saveMessageThreads();
  }
  
  // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  function renderThreadMessages(thread) {
    const messagesView = document.getElementById('messagesThreadView');
    
    if (!thread || !thread.messages || thread.messages.length === 0) {
      messagesView.innerHTML = `
        <div class="empty-messages">
          <div class="empty-icon">
            <i class="bi bi-chat-left"></i>
          </div>
          <div class="empty-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</div>
          <div class="empty-hint">Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</div>
        </div>
      `;
      return;
    }
    
    let messagesHTML = '';
    let currentDate = '';
    
    thread.messages.forEach(message => {
      // Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ø°Ø§ ØªØºÙŠØ±
      if (message.date !== currentDate) {
        currentDate = message.date;
        const dateObj = new Date(message.date);
        const dateString = dateObj.toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        messagesHTML += `
          <div class="message-date">
            <span>${dateString}</span>
          </div>
        `;
      }
      
      // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø±Ø³Ù„Ø© Ø£Ùˆ Ù…Ø³ØªÙ„Ù…Ø©
      const isSent = message.senderId === currentUser.id;
      const messageClass = isSent ? 'message sent' : 'message received';
      
      messagesHTML += `
        <div class="${messageClass}">
          <div class="message-bubble">${message.text}</div>
          <div class="message-time">${message.time}</div>
        </div>
      `;
    });
    
    messagesView.innerHTML = messagesHTML;
    
    // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ø¹Ø±Ø¶ Ø£Ø­Ø¯Ø« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    setTimeout(() => {
      messagesView.scrollTop = messagesView.scrollHeight;
    }, 100);
  }
  
  // Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
  function startNewThread() {
    const modal = new bootstrap.Modal(document.getElementById('newThreadModal'));
    
    // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
    const select = document.getElementById('newThreadEmployeeSelect');
    select.innerHTML = '';
    
    employees.forEach(employee => {
      // ØªØ¬Ù†Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
      if (employee.id !== currentUser.id) {
        const option = document.createElement('option');
        option.value = employee.id;
        option.textContent = employee.name;
        select.appendChild(option);
      }
    });
    
    modal.show();
  }
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
  function createNewThread() {
    const select = document.getElementById('newThreadEmployeeSelect');
    const messageInput = document.getElementById('newThreadMessage');
    
    const employeeId = parseInt(select.value);
    const messageText = messageInput.value.trim();
    
    if (!employeeId || !messageText) {
      showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸Ù ÙˆÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø©", "error");
      return;
    }
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸Ù
    const employee = employees.find(emp => emp.id === employeeId);
    if (!employee) {
      showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸Ù", "error");
      return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
    let existingThread = messageThreads.find(thread => thread.employeeId === employeeId);
    
    if (existingThread) {
      // ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
      openThread(existingThread.id);
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      bootstrap.Modal.getInstance(document.getElementById('newThreadModal')).hide();
      return;
    }
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
    const newThreadId = messageThreads.length > 0 ? Math.max(...messageThreads.map(t => t.id)) + 1 : 1;
    const now = new Date();
    const timeString = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
    const dateString = now.toISOString().split('T')[0];
    
    const newThread = {
      id: newThreadId,
      employeeId: employeeId,
      employeeName: employee.name,
      lastMessage: messageText,
      lastMessageTime: timeString,
      unread: 0,
      messages: [
        { id: 1, senderId: currentUser.id, text: messageText, time: timeString, date: dateString }
      ],
      createdAt: dateString
    };
    
    messageThreads.push(newThread);
    saveMessageThreads();
    
    // ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    openThread(newThreadId);
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆÙ…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
    bootstrap.Modal.getInstance(document.getElementById('newThreadModal')).hide();
    messageInput.value = '';
    
    showToast("ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­", "success");
  }
  
  // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
  function sendInternalMessage() {
    const messageInput = document.getElementById('msgBody');
    const messageText = messageInput.value.trim();
    
    if (!messageText) {
      showToast("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø©", "error");
      return;
    }
    
    if (!activeThreadId) {
      showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­Ø§Ø¯Ø«Ø© Ø£ÙˆÙ„Ø§Ù‹", "error");
      return;
    }
    
    const thread = messageThreads.find(t => t.id === activeThreadId);
    if (!thread) {
      showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©", "error");
      return;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    const now = new Date();
    const timeString = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
    const dateString = now.toISOString().split('T')[0];
    
    const newMessageId = thread.messages.length > 0 ? Math.max(...thread.messages.map(m => m.id)) + 1 : 1;
    
    thread.messages.push({
      id: newMessageId,
      senderId: currentUser.id,
      text: messageText,
      time: timeString,
      date: dateString
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© ÙˆÙˆÙ‚ØªÙ‡Ø§
    thread.lastMessage = messageText;
    thread.lastMessageTime = timeString;
    
    saveMessageThreads();
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    renderThreadMessages(thread);
    
    // Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
    messageInput.value = '';
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
    renderMessageThreads();
    
    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙ‚Ø·)
    simulateReply(thread);
  }
  
  // Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
  function simulateReply(thread) {
    const replies = [
      "Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„ØªÙƒ",
      "Ø­Ø³Ù†Ø§Ù‹ØŒ Ø³Ø£ÙØ¹Ù„ Ø°Ù„Ùƒ",
      "Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù…Ø²ÙŠØ¯ØŸ",
      "Ø£ØªÙÙ‚ Ù…Ø¹Ùƒ ÙÙŠ Ù‡Ø°Ø§",
      "Ø³Ø£Ø±Ø§Ø¬Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± ÙˆØ£Ø¹ÙˆØ¯ Ø¥Ù„ÙŠÙƒ",
      "Ù‡Ù„ Ù‡Ø°Ø§ Ù…Ø³ØªØ¹Ø¬Ù„ØŸ"
    ];
    
    // 50% ÙØ±ØµØ© Ù„Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    if (Math.random() > 0.5) {
      setTimeout(() => {
        const employee = employees.find(emp => emp.id === thread.employeeId);
        if (!employee) return;
        
        const now = new Date();
        const timeString = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
        const dateString = now.toISOString().split('T')[0];
        const randomReply = replies[Math.floor(Math.random() * replies.length)];
        
        const newMessageId = thread.messages.length > 0 ? Math.max(...thread.messages.map(m => m.id)) + 1 : 1;
        
        thread.messages.push({
          id: newMessageId,
          senderId: employee.id,
          text: randomReply,
          time: timeString,
          date: dateString
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© ÙˆÙˆÙ‚ØªÙ‡Ø§
        thread.lastMessage = randomReply;
        thread.lastMessageTime = timeString;
        thread.unread = (thread.unread || 0) + 1;
        
        saveMessageThreads();
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…ÙØªÙˆØ­Ø©ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        if (activeThreadId === thread.id) {
          renderThreadMessages(thread);
          thread.unread = 0;
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        renderMessageThreads();
        
        // Ø¥Ø´Ø¹Ø§Ø±
        if (chatSettings.notifications) {
          showNotification(employee.name, randomReply);
        }
      }, 2000 + Math.random() * 3000);
    }
  }
  
  // ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©
  function openChatSettings() {
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    document.getElementById('waProfileName').value = currentUser.name;
    document.getElementById('waProfileStatus').value = currentUser.status;
    
    // ØªØ¹Ø¨Ø¦Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©
    document.getElementById('waPrivacyLastSeen').value = currentUser.lastSeen || 'everyone';
    document.getElementById('waPrivacyReadReceipts').checked = currentUser.readReceipts || true;
    
    // ØªØ¹Ø¨Ø¦Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    document.getElementById('waChatWallpaper').value = chatSettings.wallpaper || 'wa1';
    document.getElementById('waChatFontSize').value = chatSettings.fontSize || 'md';
    document.getElementById('waAutoSaveMedia').checked = chatSettings.autoSaveMedia || false;
    document.getElementById('waShowPreviews').checked = chatSettings.showPreviews || true;
    
    // ØªØ¹Ø¨Ø¦Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    document.getElementById('waNotifEnabled').checked = chatSettings.notifications || true;
    document.getElementById('waNotifSound').checked = chatSettings.sound || true;
    document.getElementById('waNotifVibrate').checked = chatSettings.vibrate || true;
    document.getElementById('waNotifTone').value = chatSettings.tone || 'default';
    
    // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    const modal = new bootstrap.Modal(document.getElementById('waChatSettingsModal'));
    modal.show();
  }
  
  // Ø­ÙØ¸ Ù…Ù„Ù ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  function saveChatProfile() {
    const name = document.getElementById('waProfileName').value.trim();
    const status = document.getElementById('waProfileStatus').value.trim();
    
    if (!name) {
      showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", "error");
      return;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    currentUser.name = name;
    currentUser.status = status || "Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ù…Ù„";
    
    // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©
    currentUser.lastSeen = document.getElementById('waPrivacyLastSeen').value;
    currentUser.readReceipts = document.getElementById('waPrivacyReadReceipts').checked;
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    saveUserData();
    
    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    updateUserProfileUI();
    
    showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­", "success");
  }
  
  // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ù…Ù„Ù ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  function updateUserProfileUI() {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
    document.getElementById('sidebarUserName').textContent = currentUser.name;
    document.getElementById('sidebarStatusText').textContent = currentUser.status;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙŠØ¯Ø±
    if (document.getElementById('navbarUserName')) {
      document.getElementById('navbarUserName').textContent = currentUser.name;
    }
  }
  
  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  function updateUserStatus() {
    const statuses = ["Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ù…Ù„", "ÙÙŠ Ø§Ø¬ØªÙ…Ø§Ø¹", "Ø¨Ø¹ÙŠØ¯", "Ù…Ø´ØºÙˆÙ„", "Ù…ØªØ§Ø­"];
    const randomIndex = Math.floor(Math.random() * statuses.length);
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 20% Ù…Ù† Ø§Ù„ÙˆÙ‚Øª ÙÙ‚Ø·
    if (Math.random() < 0.2) {
      currentUser.status = statuses[randomIndex];
      saveUserData();
      updateUserProfileUI();
    }
  }
  
  // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±
  function updateLastSeen() {
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ù„ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±
    // Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ± Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
    employees.forEach(employee => {
      if (Math.random() < 0.3) {
        const now = new Date();
        const minutesAgo = Math.floor(Math.random() * 60);
        const lastSeenTime = new Date(now.getTime() - minutesAgo * 60000);
        
        if (minutesAgo < 1) {
          employee.lastSeen = "Ø§Ù„Ø¢Ù†";
        } else if (minutesAgo < 60) {
          employee.lastSeen = `Ù…Ù†Ø° ${minutesAgo} Ø¯Ù‚ÙŠÙ‚Ø©`;
        } else if (minutesAgo < 1440) {
          const hoursAgo = Math.floor(minutesAgo / 60);
          employee.lastSeen = `Ù…Ù†Ø° ${hoursAgo} Ø³Ø§Ø¹Ø©`;
        } else {
          employee.lastSeen = "Ø£ÙƒØ«Ø± Ù…Ù† ÙŠÙˆÙ…";
        }
      }
    });
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¨Ø­Ø« Ù†Ø´Ø·
    renderMessageThreads();
  }
  
  // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  function clearThread() {
    if (!activeThreadId) {
      showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­Ø§Ø¯Ø«Ø© Ø£ÙˆÙ„Ø§Ù‹", "error");
      return;
    }
    
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.")) {
      const threadIndex = messageThreads.findIndex(t => t.id === activeThreadId);
      
      if (threadIndex !== -1) {
        messageThreads.splice(threadIndex, 1);
        saveMessageThreads();
        
        activeThreadId = null;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        document.getElementById('chatPeerName').textContent = "Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø©";
        document.getElementById('chatPeerStatusText').textContent = "Ø¬Ø§Ù‡Ø²";
        document.getElementById('messagesThreadView').innerHTML = `
          <div class="empty-messages">
            <div class="empty-icon">
              <i class="bi bi-chat-left-text"></i>
            </div>
            <div class="empty-text">Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©</div>
          </div>
        `;
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        renderMessageThreads();
        
        showToast("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­", "success");
      }
    }
  }
  
  // Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
  function clearSearch() {
    document.getElementById('msgSearch').value = '';
    renderMessageThreads();
  }
  
  // ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ù…Ø­Ø¯Ø¯ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
  function toggleEmojiPicker() {
    const emojiPicker = document.getElementById('emojiPicker');
    emojiPicker.style.display = emojiPicker.style.display === 'block' ? 'none' : 'block';
  }
  
  // Ø¥Ø¯Ø±Ø§Ø¬ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙÙŠ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
  function insertEmoji(emoji) {
    const messageInput = document.getElementById('msgBody');
    messageInput.value += emoji;
    messageInput.focus();
  }
  
  // Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù
  function attachFile() {
    // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ù†Ø§ Ø³ÙŠÙƒÙˆÙ† Ø±ÙØ¹ Ù…Ù„Ù
    showToast("Ù…ÙŠØ²Ø© Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ù„ÙØ§Øª Ø³ØªÙƒÙˆÙ† Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©", "info");
  }
  
  // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  function searchInChat() {
    if (!activeThreadId) {
      showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­Ø§Ø¯Ø«Ø© Ø£ÙˆÙ„Ø§Ù‹", "error");
      return;
    }
    
    const modal = new bootstrap.Modal(document.getElementById('chatSearchModal'));
    modal.show();
  }
  
  // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  function performChatSearch() {
    const searchInput = document.getElementById('chatSearchInput');
    const searchTerm = searchInput.value.trim();
    const resultsContainer = document.getElementById('chatSearchResults');
    
    if (!searchTerm) {
      resultsContainer.innerHTML = '<div class="text-muted">Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«</div>';
      return;
    }
    
    const thread = messageThreads.find(t => t.id === activeThreadId);
    if (!thread || !thread.messages) {
      resultsContainer.innerHTML = '<div class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</div>';
      return;
    }
    
    const searchResults = thread.messages.filter(message => 
      message.text.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    if (searchResults.length === 0) {
      resultsContainer.innerHTML = `<div class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† "${searchTerm}"</div>`;
      return;
    }
    
    let resultsHTML = `<div class="search-results-count">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${searchResults.length} Ù†ØªÙŠØ¬Ø©</div>`;
    
    searchResults.forEach(message => {
      const isSent = message.senderId === currentUser.id;
      const senderName = isSent ? "Ø£Ù†Øª" : thread.employeeName;
      
      resultsHTML += `
        <div class="search-result-item">
          <div class="result-sender">${senderName}</div>
          <div class="result-text">${highlightText(message.text, searchTerm)}</div>
          <div class="result-time">${message.time} - ${message.date}</div>
        </div>
      `;
    });
    
    resultsContainer.innerHTML = resultsHTML;
  }
  
  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù†Øµ ÙÙŠ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
  function highlightText(text, term) {
    const regex = new RegExp(`(${term})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }
  
  // ØªØ¨Ø¯ÙŠÙ„ Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  function toggleChatInfo() {
    const infoPanel = document.getElementById('chatInfoPanel');
    infoPanel.style.display = infoPanel.style.display === 'flex' ? 'none' : 'flex';
  }
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±
  function showNotification(title, body) {
    // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    if (!("Notification" in window)) {
      console.log("Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
      return;
    }
    
    if (Notification.permission === "granted") {
      new Notification(title, { body, icon: "/favicon.ico" });
    } else if (Notification.permission !== "denied") {
      Notification.requestPermission().then(permission => {
        if (permission === "granted") {
          new Notification(title, { body, icon: "/favicon.ico" });
        }
      });
    }
  }
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© toast
  function showToast(message, type = "info") {
    // Ø¥Ù†ØµØ±Ø§Ù toast Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
      existingToast.remove();
    }
    
    // Ø¥Ù†Ø´Ø§Ø¡ toast Ø¬Ø¯ÙŠØ¯
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0`;
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    
    toast.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">
          ${message}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `;
    
    document.body.appendChild(toast);
    
    // Ø¥Ø¸Ù‡Ø§Ø± toast
    const bsToast = new bootstrap.Toast(toast, { delay: 3000 });
    bsToast.show();
    
    // Ø¥Ø²Ø§Ù„Ø© toast Ø¨Ø¹Ø¯ Ø§Ø®ØªÙØ§Ø¦Ù‡
    toast.addEventListener('hidden.bs.toast', function () {
      toast.remove();
    });
  }
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
  function refreshThreads() {
    renderMessageThreads();
    showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª", "info");
  }
</script>